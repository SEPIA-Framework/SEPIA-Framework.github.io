<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<!-- web app settings -->
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="viewport" id="sepia-viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0">
	<script>
		function sepiaFW_scale_viewport(refSize){
			if (!refSize) refSize = 240;
			if (window.screen.width < refSize && window.matchMedia("(orientation: portrait)").matches){
				var mvp = document.getElementById('sepia-viewport');
				//mvp.setAttribute('content','initial-scale=' + screen.width/340);
				mvp.setAttribute('content','width=' + refSize + ', initial-scale=' + window.screen.width/refSize + ', user-scalable=0');
			}
		}
		if (window.location.href.indexOf('isTiny=true') > 0){
			sepiaFW_scale_viewport(240);
		}else{
			sepiaFW_scale_viewport(320);
		}
	</script>
	<title>S.E.P.I.A.</title>
	<meta name="application-name" content="S.E.P.I.A."/>
	<meta name="apple-mobile-web-app-title" content="S.E.P.I.A.">
	<meta name="description" content="S.E.P.I.A. is an app and framework for your own server-based, extendable, private, intelligent assistant.">
	<meta name="theme-color" content="#000">
	<link rel="icon" sizes="192x192" href="img/icon.png">
	<link rel="apple-touch-icon" href="img/icon.png">
	
	<!-- open graph settings -->
	<meta property="og:title" content="S.E.P.I.A."/>
	<meta property="og:determiner" content="the" />
	<meta property="og:url" content="https://sepia-framework.github.io/app/"/>
	<meta property="og:description" content="S.E.P.I.A. is an app and framework for your own server-based, extendable, private, intelligent assistant.">
	<meta property="og:image" content="https://sepia-framework.github.io/img/logo.png"/>
	<meta property="og:image:width" content="960"/>
	<meta property="og:image:height" content="960"/>
	<meta property="og:image:type" content="image/png"/>
	<meta property="og:image:alt" content="SEPIA Logo"/>
	<meta property="og:image" content="https://sepia-framework.github.io/app/img/icon.png"/>
	<meta property="og:image:width" content="192"/>
	<meta property="og:image:height" content="192"/>
	<meta property="og:image:type" content="image/png"/>
	<meta property="og:image:alt" content="SEPIA Icon"/>
	<meta property="og:type" content="website"/>
	<meta property="og:locale" content="en_GB"/>
	<meta property="og:locale:alternate" content="en_US"/>
	<meta property="og:locale:alternate" content="de_DE"/>

	<!-- PWA manifest -->
	<link rel="manifest" href="sepia.webmanifest">
	
	<!-- imports -->
	<!--<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">-->
	<!-- <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,600" rel="stylesheet"> -->
	<link rel="stylesheet" href="css/sepiaFW-style.css" title='main'>
	<link rel="stylesheet" href="css/sepiaFW-style-tiny.css" title='main'>	<!-- TODO: we should load this only when needed -->
	<link rel="stylesheet" href="css/sepiaFW-style-dual-screen.css" title='main'>
	<!-- FOR MORE STYLESHEETS SEE END-OF-BODY -->
	<script src="scripts/sepiaFW.app.config.js"></script>
	<script src="scripts/sepiaFW.app.js"></script>
	<script src="scripts/sepiaFW.local.js"></script>
	<script src="settings.js"></script>
	<!-- FOR MORE JS SEE END-OF-BODY -->
	
	<script type="application/ld+json">
	{
		"@context": "http://schema.org",
		"@type": "WebSite",
		"name": "SEPIA Open Assistant",
		"url": "https://sepia-framework.github.io",
		"potentialAction": {
			"@type": "SearchAction",
			"target": "https://sepia-framework.github.io/app/index.html?q={search_term}",
			"query-input": "required name=search_term"
		}
	}
	</script>
</head>
<body>
	<!-- Scroll-to-hide area for web-apps --><!--<div id="sepiaFW-minimal-ui-sa" style="min-height:100px; background-color:#000; color:#fff;">Scroll to hide</div>
	-->
	<!-- Login -->
	<div id="sepiaFW-login-box">
		<div id="sepiaFW-language-selector"></div>
		<div id="sepiaFW-login-box-menu-btn"><i class="material-icons md-18">&#xE5D2;</i></div>
		<h2><!--Welcome--><script>SepiaFW.local.w('welcome')</script></h2>
		<div id="sepiaFW-login-form" style="display: none">
			<input id="sepiaFW-login-id" type="email" placeholder="Username" aria-label="Username" spellcheck="false" autocomplete="username">
			<input id="sepiaFW-login-pwd" type="password" placeholder="Password" aria-label="Password">
			<button id="sepiaFW-login-send"><script>SepiaFW.local.w('sendLogin')</script></button><br>
			<button id="sepiaFW-login-close" class="extended-controls" style="display:none;"><script>SepiaFW.local.w('closeLogin')</script></button><br>
			<button id="sepiaFW-login-retry" style="display:none;"><script>SepiaFW.local.w('retry')</script></button><br>
		</div>
		<!-- Host-name pre-login box -->
		<div id="sepiaFW-host-name-box" class="extended-controls" style="display:none;">
			<label>Hostname:</label>
			<input id="sepiaFW-login-host-name" type="url" name="hostname" placeholder="my.example.org/sepia" aria-label="Hostname" spellcheck='false' autocomplete="url">
			<button id="sepiaFW-login-host-details">i</button>
		</div>
		<!-- Status and info links -->
		<div id="sepiaFW-login-wait">
			<button><script>SepiaFW.local.w('connecting')</script></button>
		</div>
		<p id="sepiaFW-login-status"></p>
		<div id="sepiaFW-login-links" style="display: none">
			<a id="sepiaFW-login-license-btn" href="license.html" target="_blank"><script>SepiaFW.local.w('license')</script></a>
			<a id="sepiaFW-login-policy-btn" href="https://sepia-framework.github.io/privacy-policy.html" target="_blank"><script>SepiaFW.local.w('data_privacy')</script></a>
		</div>
		<!-- extend button -->
		<div id="sepiaFW-login-extend-box" style="visibility: hidden;">
			<button id="sepiaFW-login-extend-btn"><i class="material-icons md-btn2">&#xE5C5;</i></button>
		</div>
		<!-- help button -->
		<button id="sepiaFW-login-help-btn" onclick="SepiaFW.ui.actions.openUrlAutoTarget('https://github.com/SEPIA-Framework/sepia-docs#welcome-to-the-documentation-page-for-sepia');"><i class="material-icons md-inherit">help</i></button>
	</div>
	<!-- Main -->
	<div id="sepiaFW-main-window" class="sepiaFW-translucent-10 sepiaFW-skin-mod">
		<!-- Menues -->
		<div id="sepiaFW-chat-menu" class="sepiaFW-menu" style="display:none;"><!-- Dynamic content --></div>
		<div id="sepiaFW-chat-channel-view" class="sepiaFW-menu" style="display:none;">
			<div class="left">
				<h2><i class="material-icons md-txt">rss_feed</i>&nbsp;<script>SepiaFW.local.w('channels')</script></h2>
				<ul id="sepiaFW-chat-channellist"><!-- Dynamic content --></ul>
			</div>
			<div class="right">
				<h2><i class="material-icons md-txt">people</i>&nbsp;<script>SepiaFW.local.w('active_users')</script></h2>
				<ul id="sepiaFW-chat-userlist"><!-- Dynamic content --></ul>
			</div>
			<div id="sepiaFW-chat-channel-controls">
				<button id="sepiaFW-chat-channel-manager-btn" class="sepiaFW-chat-channel-controls-btn">
					<i class="material-icons md-txt">rss_feed</i>&nbsp;<script>SepiaFW.local.w('edit')</script>
				</button>
				<button id="sepiaFW-chat-invite-btn" class="sepiaFW-chat-channel-controls-btn contextual">
					<i class="material-icons md-txt">person_add</i>&nbsp;<script>SepiaFW.local.w('invite')</script>
				</button>
				<button id="sepiaFW-chat-logout-btn" class="sepiaFW-chat-channel-controls-btn">
					<i class="material-icons md-txt">person_outline</i>&nbsp;<script>SepiaFW.local.w('sign_out')</script>
				</button>
			</div>
		</div>
		<div id="sepiaFW-chat-controls-more-menu" class="sepiaFW-menu">
			<div id="sepiaFW-location-ctrls">
				<span id='sepiaFW-menue-status-text'><script>SepiaFW.local.w('locateMe')</script></span>
				<button id='sepiaFW-geolocation-btn'><i class="material-icons md-txt">place</i></button>
			</div>
			<div id='sepiaFW-audio-ctrls'>
				<div id='sepiaFW-audio-ctrls-title-container'>
					<div id='sepiaFW-audio-ctrls-title'>SepiaFW audio player</div>
					<canvas id='sepiaFW-audio-ctrls-canvas'></canvas>
					<div id="sepiaFW-audio-ctrls-soundbars">
						<div class="sepiaFW-audio-soundbar"></div>
						<div class="sepiaFW-audio-soundbar"></div>
						<div class="sepiaFW-audio-soundbar"></div>
					</div>
				</div>
				<div id='sepiaFW-audio-ctrls-buttons-container'>
					<button id='sepiaFW-audio-ctrls-voldown'><i class="material-icons md-24">&#xE04D;</i><div id="sepiaFW-audio-ctrls-vol">10</div></button>
					<button id='sepiaFW-audio-ctrls-volup'><i class="material-icons md-24">&#xE050;</i></button>
					<button id='sepiaFW-audio-ctrls-start'><i class="material-icons md-24">&#xE037;</i></button>
					<button id='sepiaFW-audio-ctrls-stop'><i class="material-icons md-24">&#xE034;</i></button>
				</div>
			</div>
			<div id="sepiaFW-more-menu-shortcuts">
				<button id='sepiaFW-shortcut-btn-shop'><i class="material-icons md-24">&#xE8CC;</i></button>
				<button id='sepiaFW-shortcut-btn-todo'><i class="material-icons md-24">assignment</i></button> <!-- ballot -->
				<button id='sepiaFW-shortcut-btn-radio'><i class="material-icons md-24">&#xE03E;</i></button>
				<button id='sepiaFW-shortcut-btn-timer'><i class="material-icons md-24">timer</i></button> <!-- av_timer -->
				<button id='sepiaFW-shortcut-btn-alarm'><i class="material-icons md-24">alarm</i></button>
				<button id='sepiaFW-shortcut-btn-weather'><i class="material-icons md-24">&#xE430;</i></button>
				<button id='sepiaFW-shortcut-btn-news'><i class="material-icons md-24">local_library</i></button>
				<button id='sepiaFW-shortcut-btn-myEvents'><i class="material-icons md-24">&#xE55A;</i></button>
				<button id='sepiaFW-shortcut-btn-inAppBrowser'><i class="material-icons md-24">&#xE894;</i></button>
			</div>
			<div id="sepiaFW-more-menu-actions">
				<li id='sepiaFW-history-btn'><script>SepiaFW.local.w('clearHistory')</script>&nbsp;<i class="material-icons md-txt">&#xE889;</i></li>
				<li id='sepiaFW-saythis-btn'>Broadcast&nbsp;<i class="material-icons md-txt">record_voice_over</i></li>
				<li id='sepiaFW-teachUI-open'>Teach&nbsp;<i class="material-icons md-txt">&#xE87B;</i></li>
				<li id='sepiaFW-fullsize-btn'>Screen&nbsp;<i class="material-icons md-txt">&#xE56B;</i></li>
				<li id='sepiaFW-alwaysOn-btn'>Always On&nbsp;<i class="material-icons md-txt">mobile_friendly</i></li>
				<!--<li id='sepiaFW-back-btn'><script>SepiaFW.local.w('back')</script>&nbsp;<i class="material-icons md-txt">&#xE408;</i></li>-->
			</div>
		</div>
		<!-- Nav-Bar -->
		<div id="sepiaFW-nav-bar">
			<button id="sepiaFW-nav-menu-btn"><i class="material-icons md-btn2">&#xE5D2;</i></button>
			<button id="sepiaFW-nav-menu-go-left">•</button>
			<div id="sepiaFW-nav-label-box">
				<div id="sepiaFW-nav-label">S.E.P.I.A.</div><span id='sepiaFW-nav-label-note' style='display:none;'>...</span>
				<div id="sepiaFW-nav-label-online-status" class="offline">offline</div>
			</div>
			<button id="sepiaFW-nav-menu-go-right">•</button>
			<button id="sepiaFW-nav-users-btn"><i class="material-icons md-btn2">&#xE8CD;</i></button>
			<div id="sepiaFW-nav-bar-page-indicator"><div>&nbsp;</div><div>&nbsp;</div><div>&nbsp;</div></div>
		</div>
		<!-- Output views -->
		<div id='sepiaFW-main-output-carousel' class="sepiaFW-inner-container sepiaFW-carousel">
			<div class='sepiaFW-carousel-pane-container'>
				<div id="sepiaFW-my-view" class='sepiaFW-carousel-pane sepiaFW-results-container'><!-- dynamic content --><h2 id='sepiaFW-my-view-intro'><script>SepiaFW.local.w('view_home')</script></h2></div>
				<div id="sepiaFW-chat-output-container" class='sepiaFW-inner-container sepiaFW-carousel-pane'>
					<div id="sepiaFW-chat-output" class="sepiaFW-results-container"><!-- dynamic content --><h2><script>SepiaFW.local.w('view_chat')</script></h2></div>
				</div>
				<div id="sepiaFW-result-view" class='sepiaFW-carousel-pane sepiaFW-results-container'><!-- dynamic content --><h2><script>SepiaFW.local.w('view_extended_results')</script></h2></div>
			</div>
		</div>
		<!-- Controls -->
		<div id="sepiaFW-chat-controls">
			<div id="sepiaFW-chat-controls-right">
				<button id="sepiaFW-chat-controls-more-btn" class="eButton"><i class="material-icons md-btn">&#xE5C3;</i></button>
			</div>
			<div id="sepiaFW-assist-btn-area">
				<button id="sepiaFW-assist-btn"><i class="material-icons md-mic">&#xE029;</i></button>
				<div id="sepiaFW-assist-btn-orbiters" class="sepiaFW-animation-rotate1 sepiaFW-animation-pause"><div id="sepiaFW-assist-btn-orbiter1"></div></div>
			</div>
			<div id="sepiaFW-chat-controls-form">
				<button id="sepiaFW-chat-send" class="sButton"><i class="material-icons md-btn">&#xE163;</i></button>
				<input id="sepiaFW-chat-input" placeholder="" aria-label="Message" autocomplete="off">
				<div id="sepiaFW-chat-controls-swipe-area">
					<div id="sepiaFW-swipeBar-chat-controls" class='sepiaFW-swipeBar-switchable'><span>TOUCH BAR</span></div>
					<div id="sepiaFW-swipeBar-menu-controls" class='sepiaFW-swipeBar-switchable'><span>MENUE BAR</span></div>
				</div>
			</div>
		</div>
		<div id="sepiaFW-chat-controls-speech-box" style="display:none;">
			<div id="sepiaFW-chat-controls-speech-box-edit"><i class="material-icons md-18">&#xE14C;</i></div><!-- &#xE3C9; -->
			<div id="sepiaFW-chat-controls-speech-box-bubble" style="display: none;"></div>
			<div id="sepiaFW-chat-controls-speech-box-bubble-loader"><div></div><div></div><div></div></div>
			<div id="sepiaFW-chat-controls-speech-box-finish"><i class="material-icons md-18">&#xE409;</i></div><!-- &#xE163; -->
		</div>
		<!-- TeachUI layer -->
		<div id="sepiaFW-teachUI-view" class="sepiaFW-top-layer-view" style="display: none;">
		</div>
		<!-- Content frames layer -->
		<div id="sepiaFW-frames-view" class="sepiaFW-top-layer-view" style="display: none;">
		</div>
		<!-- message popup -->
		<div id='sepiaFW-cover-layer' class='sepiaFW-popup-cover-layer' style='display: none;'>
			<div id='sepiaFW-popup-message' class='sepiaFW-input-popup'>
				<div id='sepiaFW-popup-message-content'></div>
				<div id='sepiaFW-popup-message-controls'>
					<input id='sepiaFW-popup-message-input-one'>
					<input id='sepiaFW-popup-message-input-two'>
					<button id='sepiaFW-popup-message-btn-one'>OK</button>
					<button id='sepiaFW-popup-message-btn-two'>ABORT</button>
					<button id='sepiaFW-popup-message-btn-three'>RETRY</button>
					<button id='sepiaFW-popup-message-btn-four'>IGNORE</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Swipe bars -->
	<div id='sepiaFW-swipeBar-container-left' class='sepiaFW-swipeBar-container'>
		<div id='sepiaFW-swipeBar-chat-left' class='sepiaFW-swipeBar-switchable' oncontextmenu='return false;'></div>
		<div id='sepiaFW-swipeBar-menu-left' class='sepiaFW-swipeBar-switchable' oncontextmenu='return false;'></div>
		<div id='sepiaFW-swipeBar-teach-left' class='sepiaFW-swipeBar-switchable' oncontextmenu='return false;'></div>
		<div id='sepiaFW-swipeBar-frames-left' class='sepiaFW-swipeBar-switchable' oncontextmenu='return false;'></div>
	</div>
	<div id='sepiaFW-swipeBar-container-right' class='sepiaFW-swipeBar-container'>
		<div id='sepiaFW-swipeBar-chat-right' class='sepiaFW-swipeBar-switchable' oncontextmenu='return false;'></div>
		<div id='sepiaFW-swipeBar-menu-right' class='sepiaFW-swipeBar-switchable' oncontextmenu='return false;'></div>
		<div id='sepiaFW-swipeBar-teach-right' class='sepiaFW-swipeBar-switchable' oncontextmenu='return false;'></div>
		<div id='sepiaFW-swipeBar-frames-right' class='sepiaFW-swipeBar-switchable' oncontextmenu='return false;'></div>
	</div>
	<!-- top and bottom swipe bars are usually in conflict with OS
	<div id="sepiaFW-swipeBar-container-top" class='sepiaFW-swipeBar-container'></div>
	<div id="sepiaFW-swipeBar-container-bottom" class='sepiaFW-swipeBar-container'></div>
	-->
	<!-- Overlay elements -->
	<div id='sepiaFW-overlay-elements'>
		<!-- color refs -->
		<div id='sepiaFW-colorRefBox'>
			<b id='sepiaFW-pC'></b><b id='sepiaFW-sC'></b><b id='sepiaFW-sC2'></b><b id='sepiaFW-aC'></b><b id='sepiaFW-aC2'></b><b id='sepiaFW-asC'></b><b id='sepiaFW-adC'></b><b id='sepiaFW-lC'></b>
			<b id='sepiaFW-statC'></b><b id='sepiaFW-navC'></b>
		</div>
		<!-- press indicators -->
		<div id='sepiaFW-long-press-indicator-div' class='sepiaFW-long-press-indicator'></div>
		<!-- loader -->
		<div id='sepiaFW-loader'></div>
	</div>
	<!-- Audio players (invisible) -->
	<div id='sepiaFW-audio-players-box'>
		<audio id="sepiaFW-audio-player" src="sounds/empty.mp3" controls="controls" title="SepiaFW Sound"></audio>
		<audio id="sepiaFW-audio-player2" src="sounds/empty.mp3" controls="controls" title="SepiaFW Sound2"></audio>
		<audio id="sepiaFW-audio-speaker" src="sounds/empty.mp3" controls="controls" title="SepiaFW TTS"></audio>
	</div>
<!-- LOW PRIO STYLESHEETS -->
<link rel="stylesheet" href="css/googleMaterialIcons.css">
<link rel="stylesheet" href="css/sepiaFW-font.css">
<link rel="stylesheet" href="css/sepiaFW-cards.css">
<link rel="stylesheet" href="css/sepiaFW-teachUI.css">
<link rel="stylesheet" href="css/sepiaFW-frames.css">
<link rel="stylesheet" href="css/sepiaFW-alwaysOn.css">
<script>
	//Optimized skin loader
	(function(){
		var skins = {
			"Neo Sepia": 			{id:  1, css: "css/sepiaFW-skin-neo-sepia.css", 		avatar: "1"},
			"Neo Sepia Dark": 		{id:  2, css: "css/sepiaFW-skin-neo-sepia-dark.css", 	avatar: "1"},
			"Legacy": 				{id:  3, css: "css/sepiaFW-skin-legacy.css", 			avatar: "1"},
			"Legacy Dark":			{id:  4, css: "css/sepiaFW-skin-dark-sepia.css", 		avatar: "1"},
			"Bytemind":				{id:  5, css: "css/sepiaFW-skin-bytemind.css", 			avatar: "1"},
			"Street":				{id:  6, css: "css/sepiaFW-skin-street.css", 			avatar: "1"},
			"Sakura":				{id:  7, css: "css/sepiaFW-skin-sakura.css", 			avatar: "1"},
			"9 to 5":				{id:  8, css: "css/sepiaFW-skin-9to5.css", 				avatar: "1"},
			"Autum":				{id:  9, css: "css/sepiaFW-skin-autum.css", 			avatar: "1"},
			"Nippon":				{id: 10, css: "css/sepiaFW-skin-nippon.css", 			avatar: "1"},
			"Poppy":				{id: 11, css: "css/sepiaFW-skin-poppy.css", 			avatar: "1"},
			"Orange Style 1":		{id: 12, css: "css/sepiaFW-skin-os1.css", 				avatar: "1"},
			"My Message":			{id: 13, css: "css/sepiaFW-skin-myMessage.css", 		avatar: "1"},
			"Uplink":				{id: 14, css: "css/sepiaFW-skin-uplink.css", 			avatar: "1"},
			"Tasty":				{id: 15, css: "css/sepiaFW-skin-pizza.css", 			avatar: "1"},
			"The Grid":				{id: 16, css: "css/sepiaFW-skin-grid.css", 				avatar: "1"},
			"Canny": 				{id: 17, css: "css/sepiaFW-skin-canny.css", 			avatar: "1"},
			"Essential": 			{id: 18, css: "css/sepiaFW-skin-minimal.css", 			avatar: "1"},
			"Study": 				{id: 19, css: "css/sepiaFW-skin-study.css", 			avatar: "1"},
			"Professional": 		{id: 20, css: "css/sepiaFW-skin-professional.css", 		avatar: "1"},
			"Odyssey 1": 			{id: 21, css: "css/sepiaFW-skin-odyssey1.css", 			avatar: "3"},
			"Odyssey 2": 			{id: 22, css: "css/sepiaFW-skin-odyssey2.css", 			avatar: "3"},
			"Malachite": 			{id: 23, css: "css/sepiaFW-skin-malachite.css", 		avatar: "1"},
			"Nightlife": 			{id: 24, css: "css/sepiaFW-skin-neon.css", 				avatar: "1"},
			"Spots": 				{id: 25, css: "css/sepiaFW-skin-spot.css", 				avatar: "1"},
			"Dark Canary": 			{id: 26, css: "css/sepiaFW-skin-canary-dark.css", 		avatar: "1"},
			"ILA Legacy": 			{id: 27, css: "css/sepiaFW-skin-ILA-legacy.css", 		avatar: "2"},
			"Historic Future": 		{id: 28, css: "css/sepiaFW-skin-history-of-future.css", avatar: "3"},
			//"Future Reloaded": 	{id: 29, css: "css/sepiaFW-skin-future-reloaded.css", avatar: "3"},
			"Flaming Squirrel":			{id: 30, css: "css/sepiaFW-skin-flaming-squirrel.css", 		avatar: "4"},
			"Flaming Dark Squirrel":	{id: 31, css: "css/sepiaFW-skin-flaming-squirrel-dark.css", avatar: "4", base: 30}
		}
		var avatars = {
			"Classic": 				{id:  1, css: "css/sepiaFW-avatar-classic.css"},
			"ILA 9000":				{id:  2, css: "css/sepiaFW-avatar-ILA.css"},
			"Star Control": 		{id:  3, css: "css/sepiaFW-avatar-star-control.css"},
			"Flaming Squirrel":		{id:  4, css: "css/sepiaFW-avatar-flaming-squirrel.css"}
		}
		var skinNames = Object.keys(skins);
		var askin = SepiaFW.data.get("activeSkin") || "1";
		var defaultAvatar = "1";
		if (!isNaN(+askin)) askin = +askin;
		else askin = skins[askin].id;
		var aSkinBase;
		for (var i=0; i<skinNames.length; i++){
			var id = skins[skinNames[i]].id;
			if (id == askin){
				aSkinBase = skins[skinNames[i]].base || "";
				break;
			}
		}
		for (var i=0; i<skinNames.length; i++){
			var id = skins[skinNames[i]].id;
			var baseId = skins[skinNames[i]].base || "";
			var r = (askin == id || id == aSkinBase)? "stylesheet" : "stylesheet alternate";
			var t = (askin == id || id == aSkinBase)? "main" : "";
			var d = (askin == id || id == aSkinBase)? "" : "disabled";
			if (askin == id) defaultAvatar = skins[skinNames[i]].avatar;
			document.write("<link rel='" + r + "' href='" + skins[skinNames[i]].css + "' class='sepiaFW-style-skin' title='" + t + "' "
				+ "data-id='" + id + "' " + "data-base='" + baseId + "' " + "data-name='" + skinNames[i] + "' " 
				+ "data-avatar='" + skins[skinNames[i]].avatar + "' " + d + ">");
		}
		var avatarNames = Object.keys(avatars);
		var aav = SepiaFW.data.get("activeAvatar") || defaultAvatar;
		if (!isNaN(+aav)) aav = +aav;
		else aav = avatars[aav].id;
		var aAvBase;
		for (var i=0; i<avatarNames.length; i++){
			var id = avatars[avatarNames[i]].id;
			if (id == aav){
				aAvBase = avatars[avatarNames[i]].base || "";
				break;
			}
		}
		for (var i=0; i<avatarNames.length; i++){
			var id = avatars[avatarNames[i]].id;
			var base = avatars[avatarNames[i]].base || "";
			var r = (aav == id || id == aAvBase)? "stylesheet" : "stylesheet alternate";
			var t = (aav == id || id == aAvBase)? "main" : "";
			var d = (aav == id || id == aAvBase)? "" : "disabled";
			document.write("<link rel='" + r + "' href='" + avatars[avatarNames[i]].css + "' class='sepiaFW-style-avatar' title='" + t + "' "
				+ "data-id='" + id + "' " + "data-base='" + base + "' " + "data-name='" + avatarNames[i] + "' " + d + ">");
		}
		SepiaFW.debug.info("Config - Loaded skin: " + askin + " - Loaded avatar: " + aav);
	})();
</script>
<!-- IE11 Polyfills -->
<script src="scripts/ie11.polyfills.js"></script>
<!-- START JS -->
<script src="scripts/jquery-3.4.1.min.js"></script>
<!--<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>-->
<script src="scripts/sjcl.js"></script>
<script src="scripts/recorder.js"></script>
<script src="scripts/vad.js"></script>
<script src="scripts/hammer.min.js"></script>
<script src="scripts/hammer-time.min.js"></script>
<script src="scripts/svg-inject.min.js"></script>
<script src="scripts/purify.min.js"></script>
<!-- SEPIA -->
<script src="scripts/clexi-0.8.2.js"></script>
<script src="scripts/sepiaFW.ui.js"></script>
<script src="scripts/sepiaFW.ui.build.js"></script>
<script src="scripts/sepiaFW.ui.animate.js"></script>
<script src="scripts/sepiaFW.ui.notify.js"></script>
<script src="scripts/sepiaFW.ui.carousel.js"></script>
<script src="scripts/sepiaFW.ui.dragDrop.js"></script>
<script src="scripts/sepiaFW.ui.events.js"></script>
<script src="scripts/sepiaFW.ui.actions.js"></script>
<script src="scripts/sepiaFW.ui.cards.js"></script>
<script src="scripts/sepiaFW.ui.customButtons.js"></script>
<script src="scripts/sepiaFW.account.js"></script>
<script src="scripts/sepiaFW.account.contacts.js"></script>
<script src="scripts/sepiaFW.assistant.js"></script>
<script src="scripts/sepiaFW.geocoder.js"></script>
<script src="scripts/sepiaFW.audio.js"></script>
<script src="scripts/sepiaFW.audioRecorder.js"></script>
<script src="scripts/sepiaFW.speechWebSocket.js"></script>
<script src="scripts/sepiaFW.speech.js"></script>
<script src="scripts/sepiaFW.webSocket.js"></script>
<script src="scripts/sepiaFW.webSocket.channels.js"></script>
<script src="scripts/sepiaFW.files.js"></script>
<script src="scripts/sepiaFW.frames.js"></script>
<script src="scripts/sepiaFW.teach.js"></script>
<script src="scripts/sepiaFW.offline.js"></script>
<script src="scripts/sepiaFW.alwaysOn.js"></script>
<script src="scripts/sepiaFW.inputControls.cmdl.js"></script>
<script src="scripts/sepiaFW.inputControls.js"></script>
<script src="scripts/sepiaFW.wakeTriggers.js"></script>
<script src="scripts/sepiaFW.wakeWordSettings.js"></script>
<script src="scripts/sepiaFW.embedded.nlu.js"></script>
<script src="scripts/sepiaFW.embedded.services.js"></script>
<script src="scripts/sepiaFW.android.js"></script>
<script src="scripts/sepiaFW.client.controls.js"></script>
<script src="scripts/sepiaFW.clexi.js"></script>
<script type="text/javascript">

	//get cordova via URL parameter
	var isCordova = SepiaFW.tools.isURLParameterTrue('cordova');

	//start-up actions (and buffered local notifications)
	function handleUrlParameterActions(isDemo, url){
		//get
		var requestViaUrl;
		var shareViaUrl;
		var openView;
		if (url){
			requestViaUrl = SepiaFW.tools.getURLParameterFromUrl(url, 'q');
			shareViaUrl = SepiaFW.tools.getURLParameterFromUrl(url, 'share');
			openView = SepiaFW.tools.getURLParameterFromUrl(url, 'view');
		}else{
			requestViaUrl = SepiaFW.tools.getURLParameter('q');
			shareViaUrl = SepiaFW.tools.getURLParameter('share');
			openView = SepiaFW.tools.getURLParameter('view');
		}

		//Url request (q)
		if (requestViaUrl){
			SepiaFW.client.handleRequestViaUrl(requestViaUrl);
		}
		//Share data (share)
		if (shareViaUrl){
			SepiaFW.client.handleShareViaUrl(shareViaUrl);
		}
		//Open view or frame (view)
		if (openView){
			SepiaFW.ui.openViewOrFrame(openView);
		}
		//NOTE: compare to deeplinks in index.js
	}
	function handleDeeplinksIntentsAndNotifications(isDemo){
		//get some Cordova transfer stuff from localStorage
		if (isCordova && "localStorage" in window){
			//get
			var deeplinkAction;
			var dlActionString = localStorage.getItem("sepia-deeplink-intent");
			if (dlActionString){
				deeplinkAction = JSON.parse(dlActionString);
				localStorage.removeItem("sepia-deeplink-intent");
			}
			var localNotification;
			var lnString = localStorage.getItem("sepia-local-note");
			if (lnString){
				localNotification = JSON.parse(lnString);
				localStorage.removeItem("sepia-local-note");
			}
			var androidIntent;
			var andiString = localStorage.getItem("sepia-android-intent");
			if (andiString){
				androidIntent = JSON.parse(andiString);
				localStorage.removeItem("sepia-android-intent");
			}
			//handle
			if (deeplinkAction){
				//Deeplink
				app.onUniversalLink(deeplinkAction);
			}
			if (androidIntent){
				//Android Intent
				app.onAndroidIntent(androidIntent);
			}
			if (localNotification){
				//Local notification
				app.onLocalNotification(localNotification);
			}
		}
	}
	function handleNotificationTriggers(isDemo){
		//get some Cordova transfer stuff from localStorage
		if (isCordova && "localStorage" in window){
			//get
			var triggeredLocalNotifications;
			var lnString = localStorage.getItem("sepia-local-notes-triggered");
			if (lnString && lnString.indexOf("[") == 0){
				triggeredLocalNotifications = JSON.parse(lnString);
				localStorage.removeItem("sepia-local-notes-triggered");
			}
			//handle
			if (triggeredLocalNotifications){
				//Call handler for each
				triggeredLocalNotifications.forEach(function(notification){
					app.onLocalNotificationTriggered(notification);
				});
			}
		}
	}

	//define app setup (called either here (index.html) or in cordova device-ready (index.js)
	function appSetup(){
		//get some more settings via URL parameters
		var isTest = SepiaFW.tools.isURLParameterTrue('isTest');
		var hostParam = SepiaFW.tools.getURLParameter('host');

		//is headless app?
		SepiaFW.config.isUiHeadless = SepiaFW.tools.isURLParameterTrue("isHeadless");
		if (SepiaFW.config.isUiHeadless){
			//add CSS class
			document.documentElement.className += " sepiaFW-headless-app";
			//note: is allowed to overwrite user pref.
			SepiaFW.config.loadSettingsForHeadlessMode();
		}
		//... or enable auto-setup
		SepiaFW.config.autoSetup = SepiaFW.tools.isURLParameterTrue("autoSetup");
		if (!SepiaFW.config.isUiHeadless && SepiaFW.config.autoSetup){
			//note: is allowed to overwrite user pref.
			SepiaFW.config.loadSettingsForHeadlessMode();
		}

		//prepare plugins
		SepiaFW.buildSepiaFwPlugins();

		//host URL for deeplinks
		SepiaFW.client.deeplinkHostUrl = "https://b07z.net/dl/sepia/index.html";
		SepiaFW.client.handleUrlParameterActions = handleUrlParameterActions;

		//set specific language dependent frames (pages)
		SepiaFW.frames.setLocalPage('tutorial.html', "de", 'tutorial-de.html');
	
		//set endpoints
		var config = new Object();
		var restoreHostOrDefault = hostParam || SepiaFW.data.getPermanent("host-name");
		if (!restoreHostOrDefault){
			if (window.location.pathname.indexOf("/sepia/assist/") >= 0){
				restoreHostOrDefault = window.location.protocol + "//" + window.location.host + window.location.pathname.replace(/(.*\/sepia)\/assist\/.*/, "$1");
			}else if (window.location.host.indexOf(":20721") > 0){
				restoreHostOrDefault = window.location.protocol + "//" + window.location.hostname;
			}else{
				restoreHostOrDefault = "localhost";	//or e.g. "my-server.example.org/sepia"
			}
			SepiaFW.debug.log("Config: guessed hostname=" + restoreHostOrDefault);
		}
		SepiaFW.config.setHostName(restoreHostOrDefault, true);
		//try to load host, e.g.:
		//- "localhost" (direct links),
		//- "192.168.0.99" or "api.example.com" (direct links),
		//- "192.168.0.99/sepia" or "api.example.com/sepia" (with "/sepia" path -> proxy links)
		SepiaFW.config.setEndPoints(restoreHostOrDefault, undefined, isTest);

		//Before setup - to get e.g. app type (Android, iOS etc.)
		SepiaFW.ui.beforeSetup();
		
		//Device ID
		var restoreDeviceIdOrDefault = SepiaFW.data.getPermanent('deviceId') || SepiaFW.ui.getDefaultDeviceId();
		SepiaFW.config.setDeviceId(restoreDeviceIdOrDefault, true);
				
		//set privacy policy link
		SepiaFW.config.privacyPolicyUrl = document.getElementById("sepiaFW-login-policy-btn").href;

		//add one-time onActive actions (actions triggered after client is ready, e.g. user has chat-channel)
        SepiaFW.client.addOnActiveOneTimeAction(function(){
			//Url actions
			handleUrlParameterActions(SepiaFW.client.isDemoMode());
			//Deeplinks and local notifications
			handleDeeplinksIntentsAndNotifications(SepiaFW.client.isDemoMode());
			//check server version
			SepiaFW.client.getServerInfo(function(info){
				if (!SepiaFW.client.checkServerVersion(info)){
					SepiaFW.ui.showInfo(SepiaFW.local.g('serverVersionTooLow') + " Target: v" + SepiaFW.ui.requiresServerVersion + ", found: v" + info.version);
					SepiaFW.debug.error("SEPIA Assist-Server version (low): " + info.version + " < " + SepiaFW.ui.requiresServerVersion);
				}else{
					SepiaFW.debug.log("SEPIA Assist-Server version (good): " + info.version);
				}
			});
		});

		//add one-time onActive actions that should run before my-view update
		SepiaFW.client.addOnActivePreUpdateOneTimeAction(function(){
			//read-out of triggered events queue
			handleNotificationTriggers(SepiaFW.client.isDemoMode());
		});
		
		//what happens after login?
		SepiaFW.account.afterLogin = function(){
			if (SepiaFW.client.isDemoMode()){
				//SepiaFW.ui.showInfo(SepiaFW.local.g('demoMode'), true);
				SepiaFW.ui.showCustomChatMessage(SepiaFW.local.g('demoMode'), { 
					channelId: 'info'
				});
				//pseudo client - usually handled by client.startClient()
				SepiaFW.client.buildUI();
				SepiaFW.client.onActive();
				SepiaFW.client.welcomeActions(true);
			}else{
				SepiaFW.client.ping(
					//success
					function(data){
						//Hide debug stuff O_O
						$('#sepiaFW-colorRefBox').hide();
						//TODO: startClient is a required method, maybe move it to core and replace it with 'client.onActive'?
						SepiaFW.client.startClient(); 		//includes: buildUI, onActive and welcomeActions
					},
					//fail: no connection to chat-server - note: on mobile this might trigger although network in general is down
					function(data){ doThisOnConnectionFail(data) },
					//fail: no connection at all (network problems) - optional, default: OK, TRY AGAIN
					function(data){ doThisOnConnectionFail(data) }
				);
			}
		}
		function doThisOnConnectionFail(data){
			SepiaFW.ui.showPopup(SepiaFW.local.g('noConnectionToServer'), {
				buttonOneName : SepiaFW.local.g('tryAgain'),
				buttonOneAction : function(){
					//repeat this
					SepiaFW.account.afterLogin();
				},
				buttonTwoName : SepiaFW.local.g('continueOffline'),
				buttonTwoAction : function(){
					//offline notice
					SepiaFW.ui.showCustomChatMessage(SepiaFW.local.g('noConnectionToAssistant'), { 
						channelId: 'info'
					});
					//get offline welcome help anyway
					SepiaFW.client.welcomeActions(true);
				},
				autoAction: true,
				autoActionIndex: 1,
				autoActionTargetTime: 45000,
				popupId: "afterLoginConnectionFail"
			});
		}
		
		//load UI
		SepiaFW.ui.setup();
		
		//load login
		SepiaFW.account.setupLoginBox();
	}
	
	//SETUP via browser or cordova
	if (isCordova){
		document.write(unescape(
			'%3Cscript src="cordova.js"%3E%3C/script%3E'+
			'%3Cscript src="js/index.js"%3E%3C/script%3E'
		));
	}else{
		//register service worker in non-Cordova app only for now
		if('serviceWorker' in navigator){
			navigator.serviceWorker
				.register('sw.js')
				.then(function(){ 
					SepiaFW.debug.log('Service Worker: Registered');
				}, function(err){
					SepiaFW.debug.error('Service Worker: Failed to register', err);
				});
		}else{
			SepiaFW.debug.log('Service Worker: Not available');
		}

		//call setup
		appSetup();
	}
</script>
<!-- Resources for later -->
<script src="css/googleMaterialIcons.js"></script> <!-- glyph table for icons -->
<!-- Plugins -->
</body>
</html>
